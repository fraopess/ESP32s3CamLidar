/*
 * Auto-generated file from web_index.html
 * DO NOT EDIT MANUALLY
 */

#ifndef WEB_INDEX_HTML_H
#define WEB_INDEX_HTML_H

static const char web_index_html[] =
"<!DOCTYPE html>\n<html>\n<head>\n    <title>ESP32-S3 Optical Flow Camera</title>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <style>\n        body {\n            font-family: Arial, sans-serif;\n            margin: 0;\n            padding: 20px;\n            background-color: #f0f0f0;\n        }\n        .container {\n            max-width: 1200px;\n            margin: 0 auto;\n            background-color: white;\n            padding: 20px;\n            border-radius: 8px;\n            box-shadow: 0 2px 4px rgba(0,0,0,0.1);\n        }\n        h1 {\n            color: #333;\n            margin-top: 0;\n        }\n        .main-grid {\n            display: grid;\n            grid-template-columns: 1fr 1fr;\n            gap: 20px;\n        }\n        .stream-section, .controls-section, .sensor-section {\n            background-color: #f9f9f9;\n            padding: 15px;\n            border-radius: 5px;\n        }\n        canvas {\n            border: 2px solid #333;\n            background-color: #000;\n            width: 100%;\n            height: auto;\n            image-rendering: pixelated;\n        }\n        .control-group {\n            margin-bottom: 15px;\n        }\n        .control-group label {\n            display: block;\n            margin-bottom: 5px;\n            font-weight: bold;\n            color: #555;\n        }\n        input[type=\"range\"] {\n            width: 100%;\n        }\n        .value-display {\n            display: inline-block;\n            min-width: 40px;\n            text-align: right;\n            font-family: monospace;\n        }\n        .sensor-data {\n            font-family: monospace;\n            font-size: 16px;\n        }\n        .sensor-data div {\n            margin: 10px 0;\n            padding: 8px;\n            background-color: white;\n            border-radius: 3px;\n        }\n        .status {\n            color: #28a745;\n            font-weight: bold;\n        }\n        .status.disconnected {\n            color: #dc3545;\n        }\n        @media (max-width: 768px) {\n            .main-grid {\n                grid-template-columns: 1fr;\n            }\n        }\n    </style>\n</head>\n<body>\n    <div class=\"container\">\n        <h1>ESP32-S3 Optical Flow Camera</h1>\n        <div class=\"status\" id=\"status\">Connecting...</div>\n\n        <div class=\"main-grid\">\n            <div class=\"stream-section\">\n                <h2>Camera Stream</h2>\n                <canvas id=\"stream-canvas\" width=\"160\" height=\"120\"></canvas>\n                <p><small>Grayscale 160x120 @ <span id=\"stream-fps\">--</span> FPS</small></p>\n            </div>\n\n            <div class=\"sensor-section\">\n                <h2>Sensor Data</h2>\n                <div class=\"sensor-data\">\n                    <div>Velocity X: <span id=\"vel-x\">0.000</span> m/s</div>\n                    <div>Velocity Y: <span id=\"vel-y\">0.000</span> m/s</div>\n                    <div>Distance: <span id=\"distance\">0</span> cm</div>\n                    <div>LiDAR: <span id=\"lidar-status\">---</span></div>\n                    <div>Optical Flow FPS: <span id=\"fps\">0.0</span></div>\n                    <div>Free Heap: <span id=\"heap\">0</span> bytes</div>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"controls-section\">\n            <h2>Camera Controls</h2>\n\n            <div class=\"control-group\">\n                <label>Brightness: <span class=\"value-display\" id=\"brightness-val\">0</span></label>\n                <input type=\"range\" id=\"brightness\" min=\"-2\" max=\"2\" value=\"0\" step=\"1\">\n            </div>\n\n            <div class=\"control-group\">\n                <label>Contrast: <span class=\"value-display\" id=\"contrast-val\">0</span></label>\n                <input type=\"range\" id=\"contrast\" min=\"-2\" max=\"2\" value=\"0\" step=\"1\">\n            </div>\n\n            <div class=\"control-group\">\n                <label>Saturation: <span class=\"value-display\" id=\"saturation-val\">0</span></label>\n                <input type=\"range\" id=\"saturation\" min=\"-2\" max=\"2\" value=\"0\" step=\"1\">\n            </div>\n\n            <div class=\"control-group\">\n                <label>AE Level: <span class=\"value-display\" id=\"ae_level-val\">0</span></label>\n                <input type=\"range\" id=\"ae_level\" min=\"-2\" max=\"2\" value=\"0\" step=\"1\">\n            </div>\n\n            <div class=\"control-group\">\n                <label>H-Mirror: <span class=\"value-display\" id=\"hmirror-val\">0</span></label>\n                <input type=\"range\" id=\"hmirror\" min=\"0\" max=\"1\" value=\"0\" step=\"1\">\n            </div>\n\n            <div class=\"control-group\">\n                <label>V-Flip: <span class=\"value-display\" id=\"vflip-val\">0</span></label>\n                <input type=\"range\" id=\"vflip\" min=\"0\" max=\"1\" value=\"0\" step=\"1\">\n            </div>\n        </div>\n    </div>\n\n    <script>\n        // Utility: Concatenate Uint8Arrays\n        function concatenateArrays(a, b) {\n            const result = new Uint8Array(a.length + b.length);\n            result.set(a, 0);\n            result.set(b, a.length);\n            return result;\n        }\n\n        // Utility: Find boundary in buffer\n        function findBoundary(buffer, boundary) {\n            const boundaryBytes = new TextEncoder().encode(boundary);\n            for (let i = 0; i <= buffer.length - boundaryBytes.length; i++) {\n                let match = true;\n                for (let j = 0; j < boundaryBytes.length; j++) {\n                    if (buffer[i + j] !== boundaryBytes[j]) {\n                        match = false;\n                        break;\n                    }\n                }\n                if (match) return i;\n            }\n            return -1;\n        }\n\n        // Parse multipart frame headers\n        function parseHeaders(buffer) {\n            const headerText = new TextDecoder().decode(buffer.slice(0, Math.min(200, buffer.length)));\n            const lengthMatch = headerText.match(/Content-Length:\\s*(\\d+)/i);\n            const widthMatch = headerText.match(/X-Width:\\s*(\\d+)/i);\n            const heightMatch = headerText.match(/X-Height:\\s*(\\d+)/i);\n            const headersEnd = headerText.indexOf('\\r\\n\\r\\n');\n\n            return {\n                length: lengthMatch ? parseInt(lengthMatch[1]) : null,\n                width: widthMatch ? parseInt(widthMatch[1]) : 160,\n                height: heightMatch ? parseInt(heightMatch[1]) : 120,\n                headersEnd: headersEnd >= 0 ? headersEnd + 4 : null\n            };\n        }\n\n        // Render grayscale data to canvas\n        function renderGrayscale(ctx, grayscaleData, width, height) {\n            const imageData = ctx.createImageData(width, height);\n            const rgba = imageData.data;\n\n            // Convert grayscale to RGBA\n            for (let i = 0; i < grayscaleData.length; i++) {\n                const gray = grayscaleData[i];\n                rgba[i * 4 + 0] = gray;  // R\n                rgba[i * 4 + 1] = gray;  // G\n                rgba[i * 4 + 2] = gray;  // B\n                rgba[i * 4 + 3] = 255;   // A\n            }\n\n            ctx.putImageData(imageData, 0, 0);\n        }\n\n        // Start camera stream\n        async function startStream() {\n            const canvas = document.getElementById('stream-canvas');\n            const ctx = canvas.getContext('2d');\n            let buffer = new Uint8Array(0);\n            let frameCount = 0;\n            let lastFpsUpdate = Date.now();\n\n            try {\n                const response = await fetch('/stream');\n                const reader = response.body.getReader();\n\n                document.getElementById('status').textContent = 'Connected';\n                document.getElementById('status').classList.remove('disconnected');\n\n                while (true) {\n                    const {value, done} = await reader.read();\n                    if (done) break;\n\n                    buffer = concatenateArrays(buffer, value);\n\n                    // Look for frame boundary\n                    const boundary = '\\r\\n--123456789000000000000987654321\\r\\n';\n                    const boundaryIndex = findBoundary(buffer, boundary);\n\n                    if (boundaryIndex > 0) {\n                        // Parse headers\n                        const headerData = buffer.slice(boundaryIndex + boundary.length);\n                        const headers = parseHeaders(headerData);\n\n                        if (headers.length && headers.headersEnd) {\n                            const frameStart = boundaryIndex + boundary.length + headers.headersEnd;\n                            const frameEnd = frameStart + headers.length;\n\n                            if (buffer.length >= frameEnd) {\n                                // Extract frame data\n                                const frameData = buffer.slice(frameStart, frameEnd);\n\n                                // Update canvas size if needed\n                                if (canvas.width !== headers.width || canvas.height !== headers.height) {\n                                    canvas.width = headers.width;\n                                    canvas.height = headers.height;\n                                }\n\n                                // Render frame\n                                renderGrayscale(ctx, frameData, headers.width, headers.height);\n\n                                // Update FPS\n                                frameCount++;\n                                const now = Date.now();\n                                if (now - lastFpsUpdate >= 1000) {\n                                    const fps = frameCount / ((now - lastFpsUpdate) / 1000);\n                                    document.getElementById('stream-fps').textContent = fps.toFixed(1);\n                                    frameCount = 0;\n                                    lastFpsUpdate = now;\n                                }\n\n                                // Remove processed data from buffer\n                                buffer = buffer.slice(frameEnd);\n                            }\n                        }\n                    }\n                }\n            } catch (error) {\n                console.error('Stream error:', error);\n                document.getElementById('status').textContent = 'Disconnected';\n                document.getElementById('status').classList.add('disconnected');\n\n                // Retry after 5 seconds\n                setTimeout(startStream, 5000);\n            }\n        }\n\n        // Update sensor data\n        async function updateSensorData() {\n            try {\n                const response = await fetch('/status');\n                const data = await response.json();\n\n                document.getElementById('vel-x').textContent = data.velocity_x.toFixed(3);\n                document.getElementById('vel-y').textContent = data.velocity_y.toFixed(3);\n                document.getElementById('distance').textContent = data.distance;\n                document.getElementById('lidar-status').textContent = data.lidar_valid ? 'Valid' : 'Invalid';\n                document.getElementById('fps').textContent = data.fps.toFixed(1);\n                document.getElementById('heap').textContent = data.free_heap.toLocaleString();\n            } catch (error) {\n                console.error('Status update error:', error);\n            }\n        }\n\n        // Send camera control\n        async function sendControl(name, value) {\n            try {\n                const data = {};\n                data[name] = parseInt(value);\n\n                await fetch('/control', {\n                    method: 'POST',\n                    headers: {'Content-Type': 'application/json'},\n                    body: JSON.stringify(data)\n                });\n            } catch (error) {\n                console.error('Control error:', error);\n            }\n        }\n\n        // Setup control handlers\n        function setupControls() {\n            const controls = ['brightness', 'contrast', 'saturation', 'ae_level', 'hmirror', 'vflip'];\n\n            controls.forEach(name => {\n                const slider = document.getElementById(name);\n                const display = document.getElementById(name + '-val');\n\n                slider.addEventListener('input', (e) => {\n                    display.textContent = e.target.value;\n                });\n\n                slider.addEventListener('change', (e) => {\n                    sendControl(name, e.target.value);\n                });\n            });\n        }\n\n        // Initialize on page load\n        window.addEventListener('load', () => {\n            setupControls();\n            startStream();\n            setInterval(updateSensorData, 300);  // Update every 300ms\n        });\n    </script>\n</body>\n</html>\n";

#endif // WEB_INDEX_HTML_H
